syntax = "proto3";

import "google/protobuf/any.proto";

package keboola.storageDriver.command.info;

/**
 * List of known object types
 * unknown objects will return exception
 */
enum ObjectType {
  DATABASE = 0;
  SCHEMA = 1;
  TABLE = 2;
  VIEW = 3;
}

message ObjectInfoCommand {
  repeated string path = 1;
  ObjectType expectedObjectType = 2;
}

message ObjectInfoResponse {
  repeated string path = 1;
  ObjectType objectType = 2;
  /**
   * object information's
   */
  oneof objectReflection {
    DatabaseReflection databaseReflection = 3;
    SchemaReflection schemaReflection = 4;
    ViewReflection viewReflection = 5;
    TableReflection tableReflection = 6;
  }
}

message InternalObject {
  string objectName = 1; // Object name
  ObjectType objectType = 2; // Type of object
}

message DatabaseReflection {
  repeated InternalObject objects = 1;
}

message SchemaReflection {
  repeated InternalObject objects = 1;
}
/**
 * TODO
 */
message ViewReflection {}

/**
 * Generic table information's
 * TODO dependent views
 */
message TableReflection {
  repeated string path = 1; // path where table is located
  string tableName = 2; // table name
  /**
   * Table column definition
   */
  message TableColumn {
    string name = 1;
    string type = 2;
    string length = 3;
    bool nullable = 4;
    string default = 5;
    google.protobuf.Any meta = 6; // metadata specific for each backend
    /**
     * Teradata table column metadata
     */
    message TeradataTableColumnMeta {
      bool isLatin = 1;
    }
  }
  repeated TableColumn columns = 3; // table columns definitions
  repeated string primaryKeysNames = 4; // primary key columns names
  google.protobuf.Any meta = 5; // metadata specific for each backend
}
